# 水网优化模型应用案例

本目录包含4个典型的水网优化应用案例，全面展示了水网优化模型框架的功能和应用场景。

## 案例概览

| 案例 | 名称 | 应用场景 | 主要特点 | 难度 |
|------|------|----------|---------|------|
| [案例1](./case1_urban_water_supply/) | 城市供水系统优化 | 城市供水调度 | 峰谷电价优化、泵站调度、需求保障 | ⭐⭐ |
| [案例2](./case2_hydropower_scheduling/) | 梯级水电站调度 | 水电站运行 | 梯级协调、发电优化、生态流量 | ⭐⭐⭐ |
| [案例3](./case3_irrigation_distribution/) | 灌溉水资源分配 | 农业灌溉 | 多目标优化、优先级分配、渠道损失 | ⭐⭐ |
| [案例4](./case4_simple_network/) | 简单水网示例 | 教学演示 | 基本约束、快速上手 | ⭐ |

## 案例详情

### 案例1：城市供水系统优化

**目录**: `case1_urban_water_supply/`

**问题描述**：
某城市供水系统包含1个水库、1个泵站和城市供水点。需要制定48小时供水调度方案，在峰谷电价条件下最小化供水成本，同时保证100%供水可靠性。

**关键特征**：
- 48小时调度周期
- 峰谷平三段电价（0.4-1.2元/kWh）
- 泵站分段效率曲线
- 工作日/周末需求差异
- 水库调节作用

**输出文件**：
- `results_detail.csv`: 详细数值结果
- `comprehensive_results.png`: 6面板综合结果图
- `price_optimization.png`: 电价优化分析图
- `REPORT.md`: 完整分析报告

**运行方式**：
```bash
python case1_urban_water_supply/urban_water_supply.py
```

**主要结论**：
- 总供水量：26,400 m³，满足率100%
- 总能耗：438.6 kWh
- 总成本：394.41 元
- 单位水成本：0.1169 元/m³
- 峰时段减少抽水，谷时段增加蓄水

---

### 案例2：梯级水电站调度优化

**目录**: `case2_hydropower_scheduling/`

**问题描述**：
某流域有三级串联水电站（R1→R2→R3），需要制定48小时发电调度方案。在满足水位和生态流量约束的条件下，最大化发电收益。

**关键特征**：
- 三级梯级串联系统
- 峰谷平电价优化
- 水位安全约束
- 生态流量保障（已在代码中预留）
- 机组效率曲线

**输出文件**：
- `results_detail.csv`: 详细调度方案
- `comprehensive_results.png`: 6面板结果展示
- `price_optimization.png`: 峰谷电价优化
- `REPORT.md`: 详细技术报告

**运行方式**：
```bash
python case2_hydropower_scheduling/hydropower_scheduling.py
```

**主要结论**：
- 总发电量：5,394 MWh
- 总收益：4,315,267 元
- T1贡献74.6%，T2贡献25.4%
- 峰时段增发，谷时段蓄水
- 梯级间良好协调

---

### 案例3：灌溉水资源分配优化

**目录**: `case3_irrigation_distribution/`

**问题描述**：
某灌区有1个水源（水库）和5个灌溉分区（种植水稻、小麦、玉米、蔬菜、果树）。需要制定7天配水方案，按优先级满足各分区灌溉需求。

**关键特征**：
- 单水源多分区系统
- 不同作物需水差异
- 优先级加权分配
- 渠道输水损失
- 7天调度周期

**输出文件**：
- `results_detail.csv`: 逐日配水方案
- `comprehensive_results.png`: 6面板综合分析
- `zone_comparison.png`: 分区对比图
- `REPORT.md`: 灌溉调度报告

**运行方式**：
```bash
python case3_irrigation_distribution/irrigation_distribution.py
```

**主要结论**：
- 总需水量：3,710 万m³
- 总供水量：3,280 万m³
- 总体满足率：88.42%
- 高优先级分区（粮食作物）满足率92%
- 低优先级分区（经济作物）满足率83%
- 渠道损失约12%

---

### 案例4：简单水网示例

**目录**: `case4_simple_network/`

**问题描述**：
一个最简单的水网系统：水源→需求点，演示基本功能和使用方法。

**关键特征**：
- 极简拓扑结构
- 清晰的输入输出
- 适合快速学习
- 5个时间步

**输出文件**：
- `results.csv`: 结果数据
- `results.png`: 简单可视化

**运行方式**：
```bash
python case4_simple_network/simple_network.py
```

**主要结论**：
- 演示了水量平衡
- 展示了流量约束
- 满足需求目标

---

## 快速开始

### 1. 环境准备

确保已安装所有依赖：

```bash
pip install pyomo matplotlib pandas numpy
sudo apt-get install glpk-utils  # 安装GLPK求解器
```

### 2. 运行案例

进入任一案例目录运行：

```bash
cd examples/case1_urban_water_supply
python urban_water_supply.py
```

### 3. 查看结果

每个案例的结果保存在对应的 `results/` 子目录中，包括：
- CSV数据文件
- PNG可视化图表
- Markdown详细报告

## 案例对比

### 按应用领域

- **城市供水**: 案例1
- **水电调度**: 案例2
- **农业灌溉**: 案例3
- **教学演示**: 案例4

### 按优化目标

- **成本最小化**: 案例1（供水成本）
- **收益最大化**: 案例2（发电收益）
- **缺水最小化**: 案例3（灌溉缺水）
- **基本满足**: 案例4（需求满足）

### 按网络规模

- **小规模（2-3节点）**: 案例1、案例4
- **中等规模（4-6节点）**: 案例3
- **大规模（7+节点）**: 案例2

### 按时间尺度

- **短期（5步）**: 案例4
- **中期（7天）**: 案例3
- **长期（48小时）**: 案例1、案例2

## 技术要点

### 节点类型应用

| 节点类型 | 案例应用 | 说明 |
|---------|---------|------|
| reservoir | 案例1、2、3 | 水库、蓄水池 |
| demand | 案例1、3、4 | 需求点 |
| junction | - | 连接点 |
| sink | - | 汇点 |

### 边类型应用

| 边类型 | 案例应用 | 说明 |
|--------|---------|------|
| pipeline | 案例1、4 | 管道 |
| open_channel | 案例3 | 明渠 |
| pump | 案例1 | 泵站 |
| turbine | 案例2 | 水轮机 |
| spillway | 案例2 | 溢洪道 |

### 优化技巧

1. **峰谷优化**（案例1、2）
   - 利用时变电价
   - 低价时段蓄水
   - 高价时段用水/发电

2. **优先级分配**（案例3）
   - 使用加权目标函数
   - 差异化缺水惩罚
   - 保障关键需求

3. **梯级协调**（案例2）
   - 水量平衡传递
   - 上下游耦合
   - 联合优化

4. **效率曲线**（案例1、2）
   - 分段线性近似
   - SOS2变量
   - 非线性特性处理

## 扩展建议

基于这些案例，您可以：

1. **修改参数**
   - 调整水库容量
   - 改变需求模式
   - 修改约束限制

2. **增加复杂度**
   - 添加更多节点
   - 引入不确定性
   - 考虑多目标

3. **开发新案例**
   - 供水管网优化
   - 污水处理调度
   - 雨洪管理
   - 跨流域调水

4. **集成实际数据**
   - 历史水文数据
   - 实时监测数据
   - 气象预报数据

## 常见问题

### Q1: 求解失败怎么办？

A: 检查：
- 约束是否过紧（可能无解）
- 边界是否合理
- 时间序列长度是否匹配
- 求解器是否正确安装

### Q2: 如何修改时间周期？

A: 修改配置中的 `horizon` 和相应的 `series`，确保长度一致。

### Q3: 如何添加新的约束？

A: 在 `solve_model` 函数中使用 Pyomo 的 `Constraint` 添加自定义约束。

### Q4: 可视化效果不好怎么办？

A: 调用 `configure_chinese_font()` 设置中文字体，或修改 `figsize` 和 `dpi` 参数。

## 技术支持

- 项目文档: `/README.md`
- 开发文档: `/DEVELOPMENT_SUMMARY.md`
- 问题反馈: GitHub Issues

## 引用

如果您在研究中使用了这些案例，请引用：

```
Test-Opt水网优化模型框架
https://github.com/your-repo/Test-Opt
```

---

**最后更新**: 2025年
**框架版本**: 1.0
**求解器**: GLPK 4.65+
**Python版本**: 3.8+
