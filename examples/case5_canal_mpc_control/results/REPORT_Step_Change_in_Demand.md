# 渠道MPC控制仿真报告

## 场景: Step Change in Demand

## 1. 系统描述

### 1.1 渠道系统

本系统包含4个串联池段，通过5个闸门进行调节控制：

| 池段 | 长度(m) | 宽度(m) | 目标水深(m) | 延迟时间(分钟) | 顶托系数 |
|------|---------|---------|------------|--------------|---------|
| Pool 1 | 2000 | 10 | 2.0 | 5 | 0.05 |
| Pool 2 | 2500 | 9 | 1.8 | 8 | 0.08 |
| Pool 3 | 3000 | 8 | 1.6 | 12 | 0.12 |
| Pool 4 | 2000 | 7 | 1.5 | 10 | 0.15 |

**IDZ模型特性**:
- ✅ 延迟效应：水流从上游到下游有5-12分钟延迟
- ✅ 顶托效应：下游水位影响上游流量（系数0.05-0.15）
- ✅ 回水区：非均匀流条件下的水位分布
- ✅ 动态响应：考虑渠道惯性

### 1.2 MPC控制器

**控制参数**:
- 预测时域: 60分钟（12步）
- 控制时域: 30分钟（6步）
- 采样周期: 5分钟
- 优化目标: 最小化水深偏差和控制变化

## 2. 场景设置


**取水需求**:
- Pool 1取水点: 2.0 m³/min (平均)
- Pool 2取水点: 3.0 m³/min (平均)
- Pool 3取水点: 2.5 m³/min (平均)


## 3. 控制性能

### 3.1 水深控制精度


**Pool 1** (目标水深: 2.0m) ✅ 优秀
- 平均绝对误差(MAE): 0.0091 m (0.46%)
- 均方根误差(RMSE): 0.0103 m
- 最大偏差: 0.0176 m


**Pool 2** (目标水深: 1.8m) ✅ 优秀
- 平均绝对误差(MAE): 0.0051 m (0.28%)
- 均方根误差(RMSE): 0.0065 m
- 最大偏差: 0.0156 m


**Pool 3** (目标水深: 1.6m) ❌ 需改进
- 平均绝对误差(MAE): 0.1124 m (7.03%)
- 均方根误差(RMSE): 0.1127 m
- 最大偏差: 0.1240 m


**Pool 4** (目标水深: 1.5m) ⚠️ 良好
- 平均绝对误差(MAE): 0.0761 m (5.07%)
- 均方根误差(RMSE): 0.0764 m
- 最大偏差: 0.0854 m


### 3.2 控制平滑度


**Gate 0**:
- 平均变化率: 0.180 m³/min/步
- 最大变化率: 1.980 m³/min/步


**Gate 1**:
- 平均变化率: 0.178 m³/min/步
- 最大变化率: 1.961 m³/min/步


**Gate 2**:
- 平均变化率: 0.182 m³/min/步
- 最大变化率: 2.000 m³/min/步


**Gate 3**:
- 平均变化率: 0.182 m³/min/步
- 最大变化率: 2.000 m³/min/步


**Gate 4**:
- 平均变化率: 0.210 m³/min/步
- 最大变化率: 2.000 m³/min/步



## 4. 综合评估

### 4.1 整体性能

- **水深控制精度**: 平均MAE = 0.0507 m
- **控制平滑度**: 平均变化率 = 0.186 m³/min/步

### 4.2 MPC效果分析

⚠️ **良好**: MPC控制器基本实现水深控制目标，存在小幅波动


### 4.3 延迟效应观察

由于各池段存在不同的延迟时间（5-12分钟），可以观察到：
- 上游扰动需要一定时间才能传播到下游
- MPC通过预测未来状态提前采取控制动作
- 延迟越大的池段，控制响应越慢

### 4.4 顶托效应观察

下游水位变化会影响上游池段：
- Pool 4（最下游）的顶托系数最大(0.15)
- 当下游水深升高时，上游出流减少
- MPC需要考虑这种耦合效应进行协调控制

## 5. 建议

### 5.1 控制策略优化

1. **预测时域调整**: 可以根据系统延迟特性调整预测时域
2. **权重优化**: 平衡水深控制精度和控制平滑度
3. **鲁棒性增强**: 考虑需求预测误差的影响

### 5.2 系统改进

1. **增加传感器**: 在关键位置增加水位监测点
2. **闸门升级**: 提高闸门响应速度和精度
3. **通信优化**: 降低数据传输延迟

---

**报告生成时间**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
**仿真时长**: {df['time'].iloc[-1]} 分钟
**时间步数**: {len(df)} 步
